#:kivy 2.0.0

FloatLayout:
    # 主应用布局
    slider_x: slider_x
    slider_y: slider_y
    lock_aspect_ratio_checkbox: lock_aspect_ratio_checkbox
    editor_canvas: editor_canvas
    
    canvas.before:
        Color:
            rgba: 0.15, 0.15, 0.15, 1
        Rectangle:
            pos: self.pos
            size: self.size
    
    # 标题标签
    Label:
        id: title_label
        text: 'Kivy Image Editor'
        size_hint: 1, None
        height: dp(30)
        pos_hint: {'x': 0, 'top': 1}
        font_size: '20sp'
    
    # 编辑器画布
    EditorCanvasWidget:
        id: editor_canvas
        size_hint: 1, None
        height: root.height - dp(30) - dp(60)  # 标题30dp, 工具栏60dp
        pos_hint: {'x': 0, 'top': 1 - dp(30)/root.height}
    
    # 工具栏
    BoxLayout:
        id: toolbar
        orientation: 'horizontal'
        size_hint: 1, None
        height: dp(60)
        pos_hint: {'x': 0, 'bottom': 0}
        spacing: 5
        padding: 5
        
        # 加载图像按钮
        Button:
            id: load_btn
            text: 'Load Image'
            size_hint: 0.2, 1
            on_press: app.open_file_dialog(self)
        
        # 图层操作按钮
        BoxLayout:
            orientation: 'vertical'
            size_hint: 0.2, 1
            
            # 图层顺序控制
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, 0.5
                
                Button:
                    text: 'Move Up'
                    on_press: app.editor_canvas.move_selected_layer_up()
                
                Button:
                    text: 'Move Down'
                    on_press: app.editor_canvas.move_selected_layer_down()
            
            # 图层显示和删除控制
            BoxLayout:
                orientation: 'horizontal'
                size_hint: 1, 0.5
                
                Button:
                    text: 'Show/Hide'
                    on_press: app.editor_canvas.toggle_selected_layer_visibility()
                
                Button:
                    text: 'Delete'
                    on_press: app.editor_canvas.delete_selected_layer()
        
        # 缩放控制
        BoxLayout:
            orientation: 'vertical'
            size_hint_x: 0.3
            spacing: dp(2)
            
            # X Scale Slider
            BoxLayout:
                size_hint_y: None
                height: dp(25)
                
                Label:
                    text: 'Scale X:'
                    size_hint_x: 0.3
                    font_size: '12sp'
                
                Slider:
                    id: slider_x
                    min: 0.1
                    max: 3
                    value: 1.0
                    size_hint_x: 0.7
                    disabled: True
                    on_value: app.on_slider_x_value(self, self.value)
            
            # Y Scale Slider
            BoxLayout:
                size_hint_y: None
                height: dp(25)
                
                Label:
                    text: 'Scale Y:'
                    size_hint_x: 0.3
                    font_size: '12sp'
                
                Slider:
                    id: slider_y
                    min: 0.1
                    max: 3
                    value: 1.0
                    size_hint_x: 0.7
                    disabled: True
                    on_value: app.on_slider_y_value(self, self.value)
            
            # Lock Aspect Ratio Checkbox
            BoxLayout:
                size_hint_y: None
                height: dp(25)
                
                CheckBox:
                    id: lock_aspect_ratio_checkbox
                    active: False
                    size_hint_x: 0.2
                    disabled: True
                    on_active: app.on_lock_aspect_ratio_change(self, self.active)
                
                Label:
                    text: 'Lock Aspect Ratio'
                    size_hint_x: 0.8
                    font_size: '12sp'
        
        # 使用说明
        Label:
            text: 'Instructions:\n· Click to select layer\n· Drag to move\n· Drag center point to rotate\n· Use sliders to resize'
            size_hint: 0.4, 1
            halign: 'left'
            valign: 'middle'
            text_size: self.width, None

<ImageLayerWidget>:
    # 默认属性设置
    do_rotation: False  # 禁用默认旋转
    do_scale: False  # 禁用默认缩放
    do_translation: True  # 允许移动

<EditorCanvasWidget>:
    # 设置背景颜色
    canvas.before:
        Color:
            rgba: 0.2, 0.2, 0.2, 1
        Rectangle:
            pos: self.pos
            size: self.size

<Button>:
    background_normal: ''
    background_color: 0.3, 0.5, 0.8, 1
    color: 1, 1, 1, 1
    size_hint_min: 80, 40
    font_size: '14sp'
    
<Label>:
    color: 1, 1, 1, 1
    font_size: '14sp'

<Slider>:
    cursor_size: (dp(25), dp(25))
    
<CheckBox>:
    size_hint: None, None
    size: dp(30), dp(30) 